---
title: "เคาน์เตอร์แอพด้วย bloc ในหน้าเดียว แบบจบๆ"
slug: bloc

---

Bloc เป็น library สำหรับ state management รูปแบบหนึ่งทีนิยมใช้กันใน Flutter จุดประสงค์ของการใช้ state management หลักๆก็คือการอ่านและเขียน state ที่ใช้ร่วมกันในหลายๆวิดเจ็ตได้สะดวกและมีประสิทธิภาพมากขึ้น เพราะไม่เช่นนั้นการอัพเดต state จะต้องเป็นการส่งต่อจากวิดเจ็ตแม่ลงมาเรื่อยๆ ซึ่งยากต่อการเขียนและแก้ไขอย่างมาก

Bloc library เองจริงๆก็มีตัวอย่าง ในการใช้ Bloc กับเคาน์เตอร์แอพอยู่แล้ว ซึ่งโค้ดที่เป็นตัวอย่างในบทความนี้ก็จะคัดลอกมาจากตัวอย่างจากทางเอกสารนี้เลย แต่จะคัดเลือกและเรียบเรียงให้สั้นและเข้าใจง่ายขึ้น

Bloc library จะมีวิธีการสร้างสองรูปแบบคือรูปแบบที่เป็นแบบมาตรฐานของ Bloc ที่เป็น event-driven และอีกรูปแบบนึงที่เป็น Cubit ที่เป็น function-driven ซึ่ง Cubit จะมีการใช้งานที่ตรงไปตรงมาคือเรียก function เพื่ออัพเดต state เลย การเลือกใช้มักจะขึ้นอยู่กับความซับซ้อนของแอพพลิเคชั่นและความถนัดของนักพัฒนา และในตัวอย่างจากเอกสารก็จะเป็นการใช้ Cubit เพราะความเรียบง่ายในการใช้งานนั่นเอง ต่อไปเราจะเริ่มมาสร้างองค์ประกอบโดยหัวข้อจะเป็นตามหัวข้อนี้

### สร้าง Cubit

Cubit จะเป็น class ที่เราใช้เก็บค่า state รวมถึง function ในการแก้ไขเปลี่ยนแปลงอัพเดต state ของเราด้วย

### ยัดเยียด Cubit ลงไปใน widget tree ด้วย BlocProvider

ถ้าเราไม่กำหนดว่าเราจะให้ Cubit ไปอยู่ที่ไหนเราก็ไม่สามารถสร้างวิดเจ็ตจาก state ของ Cubit ในขั้นตอนต่อไปได้

### สร้างวิดเจ็ตจาก state ใน Cubit ด้วย BlocBuilder

### สิ่งที่ต้องระวัง

* อย่าหลง context
    

### แถม: ทำไม Cubit ถึงชื่อ Cubit

คำว่า Cubit(สี่เหลี่ยมจิ๋ว คิวท์ๆ) ต้องการจะสื่อให้เหมือนชื่อเล่นหรือส่วนย่อของ Block (Bloc)ที่หมายถึงของที่เป็นสี่เหลี่ยมขนาดใหญ่นั่นเอง

ในเอกสารของ Bloc library จะพูดถึง BlocObserver ก่อนเลย ซึ่งจริงๆแล้วไม่ใช่ตัวหลักที่ทำให้ bloc ทำงานแต่จะทำหน้าที่แค่เฝ้าดู(observe)ถึงการเปลี่ยนแปลงของ bloc เท่านั้นในตัวอย่างนี้จะตัดเนื้อหานี้ออกไปเพื่อให้ตรงประเด็น